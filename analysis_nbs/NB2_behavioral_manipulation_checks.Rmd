---
title: "Experience vs. description based decision-making project: Behavioral manipulation checks"
output: html_notebook
---

# Set up environment and load in data

```{r}
library(tidyverse)
```

```{r}
library(gridExtra)
```

```{r}
helpers_path = '~/Dropbox/RangelLab/DescribedVsLearned/helpers/'
```

Read in *clean* behavioral data

```{r}
source(paste0(helpers_path,'clean_behavioral_data.R'))
```

Fit Q-learning model to get parameter estimates

```{r}
source(paste0(helpers_path,'fit_qlearning.R'))
```

# Manipulation checks

## Evidence for "learning" fractal values

As time goes by are subjects more likely to choose the fractal with the higher reward probability? There is a subtle increase in the probability of choosing the fractal with the higher reward probability. This change in probability of choosing the fractal with the higher reward probability is larger when the reward depends only on fractals (except for the last session, which bizarrely has the opposite pattern).

```{r}
p1 = clean_beh_data %>%
  mutate(leftFractalBetter = fractalLeftProb>fractalRightProb,
         choseBetterFractal = ifelse(leftFractalBetter & choiceLeft == 1, 1, 
                                     ifelse(!leftFractalBetter & choiceLeft == 0, 1, 0))) %>%
  ggplot(aes(trialNum, choseBetterFractal, col=as.factor(session)))+
  geom_smooth(formula = 'y~x', method = "glm", method.args = list(family=binomial), fullrange=TRUE, alpha=.1)+
  labs(title="All trials", x="Trial Number", y="p(Chose better fractal)", color="Session")+
  coord_cartesian(ylim=c(0.4,.8))

p2 = clean_beh_data %>%
  filter(probFractalDraw == 1) %>%
  mutate(leftFractalBetter = fractalLeftProb>fractalRightProb,
         choseBetterFractal = ifelse(leftFractalBetter & choiceLeft == 1, 1, 
                                     ifelse(!leftFractalBetter & choiceLeft == 0, 1, 0))) %>%
  ggplot(aes(trialNum, choseBetterFractal, col=as.factor(session)))+
  geom_smooth(formula = 'y~x', method = "glm", method.args = list(family=binomial), fullrange=TRUE, alpha=.1)+
  labs(title="p(Fractal)=1", x="Trial Number", y="p(Chose better fractal)", color="Session")+
  coord_cartesian(ylim=c(0.4,.8))

grid.arrange(p1, p2, nrow=1, ncol=2)
```

## Correct interpretation of $\pi$

- When p of fractal is 0 do subjects choose based on the EV difference between lotteries? Does the QV difference matter at all?

- When p of fractal is 1 do subjects choose based on the QV difference between fractals? Does the EV difference matter at all?

```{r}
clean_beh_data %>%
  filter(probFractalDraw == 1 | probFractalDraw == 0) %>%
  mutate(leftQVAdv = leftQValue - rightQValue,
         leftLotteryEV = lotteryValue*lotteryProb,
         rightLotteryEV = referenceValue*referenceProb,
         leftEVAdv = leftLotteryEV - rightLotteryEV) %>%
  select(leftQVAdv, leftEVAdv, choiceLeft, probFractalDraw) %>%
  gather(key, value, -choiceLeft, -probFractalDraw) %>%  
  mutate(key = ifelse(key == "leftEVAdv", "EV_left - EV_right", "QV_left - QV_right"),
         probFractalDraw = ifelse(probFractalDraw == 0, "p(Fractal)=0", "p(Fractal)=1"))%>%
  ggplot(aes(value, choiceLeft))+
  geom_jitter(width=0.03, height=0.08, alpha = 0.05)+
  geom_smooth(formula = 'y~x', method = "glm", method.args = list(family=binomial), fullrange=TRUE)+
  facet_grid(probFractalDraw~key)+
  xlab("")+
  ylab("p(Left)")
```

- Is there a lottery or fractal bias?

```{r}

```