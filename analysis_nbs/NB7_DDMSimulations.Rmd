---
title: "Experience vs. description based decision-making project: Adding arbitration to behavioral modeling"
output: 
  html_document:
    toc: true
    toc_float: true
    code_folding: 'hide'
---

Set up environment and load in data

```{r include=FALSE}
library(tidyverse)
library(gridExtra)
library(brms)
library(here)
cbbPalette <- c("#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")
# theme_set(theme_bw())
theme_set(theme_classic())
sem <- function(x) {sd(x, na.rm=T) / sqrt(length(x))}
helpers_path = here('helpers/')
```

```{r}
sim_trial = function(d, sigma, valueLeft, valueRight, barrier=1, nonDecisionTime=0, bias=0, timeStep=10, maxIter=1000){
  
  # d : drift rate
  # sigma: sd of the normal distribution 
  # timeStep: in ms
  
  RDV = bias
  time = 0
  elapsedNDT = 0
  choice = 0
  RT = NA
  
  while (time<maxIter){
    
    # If the RDV hit one of the barriers, the trial is over.
    if (RDV >= barrier | RDV <= -barrier){
      RT = (time * timeStep)/1000 #convert back to secs
      if (RDV >= barrier){
        choice = "left"
      } else if (RDV <= -barrier){
        choice = "right"
      }
      break
    } 
    
    
    if (elapsedNDT < nonDecisionTime / timeStep){
      mean = 0
      elapsedNDT = elapsedNDT + 1
    } else{
      mean = d * (valueLeft - valueRight)
    }
    
    # Sample the change in RDV from the distribution.
    RDV = RDV + rnorm(1, mean, sigma)
    
    time = time + 1
  }
  
  return(list(choice=choice, RT=RT))
}
```

```{r}
sim_trial(d=.02, sigma = .1, valueLeft=1, valueRight=1)
```

```{r}
sim_trial = function(d, sigma, EVLeft, EVRight, QVLeft, QVRight, probFractalDraw, barrier=1, nonDecisionTime=0, bias=0, timeStep=10, maxIter=1000){

  # d : drift rate
  # sigma: sd of the normal distribution 
  # timeStep: in ms
  
  RDV = bias
  time = 0
  elapsedNDT = 0
  choice = 0
  RT = NA
  
  while (time<maxIter){
    
    # If the RDV hit one of the barriers, the trial is over.
    if (RDV >= barrier | RDV <= -barrier){
      RT = (time * timeStep)/1000 #convert back to secs
      if (RDV >= barrier){
        choice = "left"
      } else if (RDV <= -barrier){
        choice = "right"
      }
      break
    } 
    
    
    if (elapsedNDT < nonDecisionTime / timeStep){
      mean = 0
      elapsedNDT = elapsedNDT + 1
    } else{
      valueLeft = probFractalDraw*QVLeft + (1-probFractalDraw)*(EVLeft)
      valueRight = probFractalDraw*QVRight + (1-probFractalDraw)*(EVRight)
      mean = d * (valueLeft - valueRight)
    }
    
    # Sample the change in RDV from the distribution.
    RDV = RDV + rnorm(1, mean, sigma)
    
    time = time + 1
  }
  
  return(list(choice=choice, RT=RT))
}
```

```{r}
sim_trial(d=.02, sigma = .1, EVLeft=.5, EVRight = .5, QVLeft = 1.5, QVRight= .5 , probFractalDraw = 1)
```